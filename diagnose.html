<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ºæ–·å·¥å…· - Character Editor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #58a6ff;
            margin-bottom: 30px;
            font-size: 32px;
        }
        .section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            color: #58a6ff;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .status {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #0d1117;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .status-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        .success { border-left: 3px solid #3fb950; }
        .error { border-left: 3px solid #f85149; }
        .warning { border-left: 3px solid #d29922; }
        .info { border-left: 3px solid #58a6ff; }
        pre {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            border: 1px solid #30363d;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #2ea043;
        }
        .btn-secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }
        .btn-secondary:hover {
            background: #30363d;
        }
        #console-output {
            max-height: 400px;
            overflow-y: auto;
        }
        .console-line {
            padding: 5px;
            border-bottom: 1px solid #21262d;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .console-error { color: #f85149; }
        .console-warn { color: #d29922; }
        .console-info { color: #58a6ff; }
        .console-log { color: #8b949e; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Character Editor è¨ºæ–·å·¥å…·</h1>
        
        <div class="section">
            <h2>ğŸ“‹ ç’°å¢ƒä¿¡æ¯</h2>
            <div class="status info">
                <span class="status-icon">ğŸŒ</span>
                <span>URL: <strong id="url"></strong></span>
            </div>
            <div class="status info">
                <span class="status-icon">ğŸ–¥ï¸</span>
                <span>User Agent: <strong id="ua"></strong></span>
            </div>
            <div class="status info">
                <span class="status-icon">â°</span>
                <span>æ™‚é–“: <strong id="time"></strong></span>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“¦ æ–‡ä»¶åŠ è¼‰ç‹€æ…‹</h2>
            <div id="file-status"></div>
        </div>

        <div class="section">
            <h2>ğŸ”§ JavaScript åŠŸèƒ½æ¸¬è©¦</h2>
            <div id="js-status"></div>
        </div>

        <div class="section">
            <h2>ğŸ¯ DOM å…ƒç´ æª¢æŸ¥</h2>
            <div id="dom-status"></div>
        </div>

        <div class="section">
            <h2>ğŸ“œ æ§åˆ¶å°è¼¸å‡º</h2>
            <div id="console-output"></div>
        </div>

        <div class="section">
            <button class="btn" onclick="location.reload()">ğŸ”„ é‡æ–°æª¢æ¸¬</button>
            <button class="btn btn-secondary" onclick="window.location.href='character-editor.html'">â¡ï¸ å‰å¾€ç·¨è¼¯å™¨</button>
            <button class="btn btn-secondary" onclick="window.location.href='index.html'">ğŸ  è¿”å›é¦–é </button>
        </div>
    </div>

    <script>
        // æ•ç²æ§åˆ¶å°è¼¸å‡º
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalInfo = console.info;

        function addConsoleLine(message, type = 'log') {
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = `[${type.toUpperCase()}] ${message}`;
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addConsoleLine(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addConsoleLine(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addConsoleLine(args.join(' '), 'warn');
        };

        console.info = function(...args) {
            originalInfo.apply(console, args);
            addConsoleLine(args.join(' '), 'info');
        };

        // æ•ç²éŒ¯èª¤
        window.addEventListener('error', function(e) {
            console.error(`éŒ¯èª¤: ${e.message} (${e.filename}:${e.lineno}:${e.colno})`);
        });

        // é¡¯ç¤ºç’°å¢ƒä¿¡æ¯
        document.getElementById('url').textContent = window.location.href;
        document.getElementById('ua').textContent = navigator.userAgent;
        document.getElementById('time').textContent = new Date().toLocaleString('zh-CN');

        // æ¸¬è©¦æ–‡ä»¶åŠ è¼‰
        async function testFiles() {
            const files = [
                'style.css',
                'script.js',
                'character-editor.html'
            ];

            const fileStatus = document.getElementById('file-status');
            
            for (const file of files) {
                try {
                    const response = await fetch(file);
                    const status = response.ok ? 'success' : 'error';
                    const icon = response.ok ? 'âœ…' : 'âŒ';
                    
                    fileStatus.innerHTML += `
                        <div class="status ${status}">
                            <span class="status-icon">${icon}</span>
                            <span>${file}: ${response.status} ${response.statusText}</span>
                        </div>
                    `;
                } catch (error) {
                    fileStatus.innerHTML += `
                        <div class="status error">
                            <span class="status-icon">âŒ</span>
                            <span>${file}: åŠ è¼‰å¤±æ•— - ${error.message}</span>
                        </div>
                    `;
                }
            }
        }

        // æ¸¬è©¦ JavaScript åŠŸèƒ½
        function testJavaScript() {
            const jsStatus = document.getElementById('js-status');
            const tests = [
                {
                    name: 'localStorage',
                    test: () => {
                        localStorage.setItem('test', 'ok');
                        const result = localStorage.getItem('test') === 'ok';
                        localStorage.removeItem('test');
                        return result;
                    }
                },
                {
                    name: 'Canvas API',
                    test: () => {
                        const canvas = document.createElement('canvas');
                        return !!(canvas.getContext && canvas.getContext('2d'));
                    }
                },
                {
                    name: 'FileReader API',
                    test: () => typeof FileReader !== 'undefined'
                },
                {
                    name: 'Fetch API',
                    test: () => typeof fetch !== 'undefined'
                },
                {
                    name: 'TextEncoder',
                    test: () => typeof TextEncoder !== 'undefined'
                }
            ];

            tests.forEach(({ name, test }) => {
                try {
                    const result = test();
                    const status = result ? 'success' : 'error';
                    const icon = result ? 'âœ…' : 'âŒ';
                    
                    jsStatus.innerHTML += `
                        <div class="status ${status}">
                            <span class="status-icon">${icon}</span>
                            <span>${name}: ${result ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</span>
                        </div>
                    `;
                } catch (error) {
                    jsStatus.innerHTML += `
                        <div class="status error">
                            <span class="status-icon">âŒ</span>
                            <span>${name}: éŒ¯èª¤ - ${error.message}</span>
                        </div>
                    `;
                }
            });
        }

        // åŠ è¼‰ script.js ä¸¦æª¢æŸ¥ DOM å…ƒç´ 
        function loadScriptAndCheckDOM() {
            const script = document.createElement('script');
            script.src = 'script.js?t=' + Date.now();
            
            script.onerror = function() {
                document.getElementById('dom-status').innerHTML = `
                    <div class="status error">
                        <span class="status-icon">âŒ</span>
                        <span>script.js åŠ è¼‰å¤±æ•—</span>
                    </div>
                `;
            };
            
            script.onload = function() {
                setTimeout(() => {
                    const domStatus = document.getElementById('dom-status');
                    
                    // æª¢æŸ¥å…¨å±€è®Šé‡
                    if (typeof characterData !== 'undefined') {
                        domStatus.innerHTML += `
                            <div class="status success">
                                <span class="status-icon">âœ…</span>
                                <span>characterData è®Šé‡å·²å®šç¾©</span>
                            </div>
                        `;
                    } else {
                        domStatus.innerHTML += `
                            <div class="status error">
                                <span class="status-icon">âŒ</span>
                                <span>characterData è®Šé‡æœªå®šç¾©</span>
                            </div>
                        `;
                    }

                    // æª¢æŸ¥é—œéµå‡½æ•¸
                    const functions = [
                        'openRegexEditor',
                        'updatePreview',
                        'exportCharacter',
                        'importCharacter'
                    ];

                    functions.forEach(funcName => {
                        const exists = typeof window[funcName] === 'function';
                        const status = exists ? 'success' : 'error';
                        const icon = exists ? 'âœ…' : 'âŒ';
                        
                        domStatus.innerHTML += `
                            <div class="status ${status}">
                                <span class="status-icon">${icon}</span>
                                <span>å‡½æ•¸ ${funcName}: ${exists ? 'å·²å®šç¾©' : 'æœªå®šç¾©'}</span>
                            </div>
                        `;
                    });
                }, 100);
            };
            
            document.head.appendChild(script);
        }

        // é‹è¡Œæ‰€æœ‰æ¸¬è©¦
        console.log('=== é–‹å§‹è¨ºæ–· ===');
        testFiles();
        testJavaScript();
        loadScriptAndCheckDOM();
    </script>
</body>
</html>
