<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#181818">
    <title>SillyTavern è§’è‰²å¡ç¼–è¾‘å™¨</title>
    <link rel="stylesheet" href="style.css">
    <script src="theme-handler.js"></script>
</head>

<body>
    <div class="container">
        <a href="./index.html" id="backToHome" class="back-link">
            â† è¿”å›ä¸»é 
        </a>
        <header>
            <h1>ğŸ­ SillyTavern è§’è‰²å¡ç¼–è¾‘å™¨</h1>
        </header>
        
        <script>
            // å¦‚æœåœ¨ iframe ä¸­ï¼Œéšè—è¿”å›ä¸»é¡µé“¾æ¥
            if (window.self !== window.top) {
                const backLink = document.getElementById('backToHome');
                if (backLink) {
                    backLink.style.display = 'none';
                }
            }
        </script>

        <div class="main-content">
            <div class="editor-panel">
                <h2>è§’è‰²ä¿¡æ¯</h2>

                <div class="form-group">
                    <label for="name">è§’è‰²åç§° *</label>
                    <input type="text" id="name" placeholder="è¾“å…¥è§’è‰²åç§°">
                </div>

                <div class="form-group">
                    <label for="description">è§’è‰²æè¿°</label>
                    <textarea id="description" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label for="first_mes">ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ˆä¸»è¦å¼€åœºç™½ï¼‰</label>
                    <textarea id="first_mes" rows="4" placeholder="è§’è‰²çš„å¼€åœºç™½"></textarea>
                </div>

                <div class="form-group">
                    <label>å¤‡ç”¨å¼€åœºç™½</label>
                    <button type="button" class="btn btn-secondary" onclick="addAlternateGreeting()"
                        style="width: 100%; margin-bottom: 10px;">â• æ·»åŠ å¤‡ç”¨å¼€åœºç™½</button>
                    <div id="alternateGreetingsList" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- å¤‡ç”¨å¼€åœºç™½åˆ—è¡¨ -->
                    </div>
                    <div class="help-text">æä¾›å¤šä¸ªä¸åŒçš„å¼€åœºç™½é€‰é¡¹</div>
                </div>

                <!-- è¿›é˜¶å®šä¹‰ -->
                <div class="form-group collapsible-section major-section">
                    <label class="collapsible-header" onclick="toggleSection(this, event)">
                        <span class="toggle-icon">â–¼</span> è¿›é˜¶å®šä¹‰
                    </label>
                    <div class="collapsible-content">
                        <div class="form-group">
                            <label for="personality">æ€§æ ¼ç‰¹ç‚¹</label>
                            <textarea id="personality" rows="4" placeholder="æè¿°è§’è‰²çš„æ€§æ ¼ã€è¡Œä¸ºæ–¹å¼"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="scenario">åœºæ™¯è®¾å®š</label>
                            <textarea id="scenario" rows="4" placeholder="è§’è‰²æ‰€å¤„çš„åœºæ™¯æˆ–èƒŒæ™¯æ•…äº‹"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="mes_example">å¯¹è¯ç¤ºä¾‹</label>
                            <textarea id="mes_example" rows="6"
                                placeholder="{{user}}: ä½ å¥½ï¼&#10;{{char}}: ä½ å¥½å‘€ï¼å¾ˆé«˜å…´è§åˆ°ä½ ã€‚"></textarea>
                        </div>

                        <!-- åˆ›ä½œè€…çš„ä¸­ç»§èµ„æ–™ -->
                        <div class="form-group collapsible-section sub-section">
                            <label class="collapsible-header" onclick="toggleSection(this, event)">
                                <span class="toggle-icon">â–¼</span> åˆ›ä½œè€…çš„ä¸­ç»§èµ„æ–™ï¼ˆä¸ä¼šä¸ AI æç¤ºè¯ä¸€èµ·ä¼ é€ï¼‰
                            </label>
                            <div class="collapsible-content">
                                <div class="info-box">
                                    <p>æ­¤å¤„æ‰€æœ‰å†…å®¹å‡ä¸ºé€‰å¡«ã€‚è¿™äº›ä¿¡æ¯ä¸ä¼šä¸ AI æç¤ºè¯ä¸€èµ·ä¼ é€ï¼Œä»…ç”¨äºè§’è‰²å¡çš„ç®¡ç†å’Œè¯´æ˜ã€‚</p>
                                </div>

                                <div class="form-group">
                                    <label for="creator">åˆ›å»ºè€…</label>
                                    <input type="text" id="creator" placeholder="è§’è‰²å¡åˆ›å»ºè€…åç§°">
                                    <div class="help-text">æ ‡æ³¨è§’è‰²å¡çš„åˆ›å»ºè€…</div>
                                </div>

                                <div class="form-group">
                                    <label for="character_version">è§’è‰²ç‰ˆæœ¬</label>
                                    <input type="text" id="character_version" placeholder="ä¾‹å¦‚ï¼š1.0, v2.5">
                                    <div class="help-text">è§’è‰²å¡çš„ç‰ˆæœ¬å·</div>
                                </div>

                                <div class="form-group">
                                    <label for="tags">æ ‡ç­¾</label>
                                    <input type="text" id="tags" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šå¥‡å¹», å¥³æ€§, é­”æ³•å¸ˆ">
                                    <div class="help-text">ç”¨äºåˆ†ç±»å’Œæœç´¢è§’è‰²</div>
                                </div>

                                <div class="form-group">
                                    <label for="creator_notes">åˆ›å»ºè€…å¤‡æ³¨</label>
                                    <textarea id="creator_notes" rows="3" placeholder="ç»™å…¶ä»–ç”¨æˆ·çš„å¤‡æ³¨è¯´æ˜ï¼Œä¾‹å¦‚ä½¿ç”¨å»ºè®®ã€è§’è‰²èƒŒæ™¯ç­‰"></textarea>
                                    <div class="help-text">å¯¹è§’è‰²å¡çš„é¢å¤–è¯´æ˜</div>
                                </div>

                                <div class="form-group collapsible-section">
                                    <label for="system_prompt" class="collapsible-header" onclick="toggleSection(this, event)">
                                        <span class="toggle-icon">â–¼</span> ç³»ç»Ÿæç¤ºè¯
                                    </label>
                                    <div class="collapsible-content">
                                        <textarea id="system_prompt" rows="4" placeholder="è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼Œä¼šåœ¨å¯¹è¯å¼€å§‹æ—¶å‘é€ç»™ AI"></textarea>
                                        <div class="help-text">é«˜çº§åŠŸèƒ½ï¼šè‡ªå®šä¹‰ AI çš„è¡Œä¸ºæ–¹å¼</div>
                                    </div>
                                </div>

                                <div class="form-group collapsible-section">
                                    <label for="post_history_instructions" class="collapsible-header" onclick="toggleSection(this, event)">
                                        <span class="toggle-icon">â–¼</span> å†å²åæŒ‡ä»¤
                                    </label>
                                    <div class="collapsible-content">
                                        <textarea id="post_history_instructions" rows="3" placeholder="åœ¨å¯¹è¯å†å²ä¹‹åæ’å…¥çš„æŒ‡ä»¤"></textarea>
                                        <div class="help-text">é«˜çº§åŠŸèƒ½ï¼šåœ¨æ¯æ¬¡å›å¤å‰æ’å…¥çš„é¢å¤–æŒ‡ä»¤</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="avatar">è§’è‰²å¤´åƒ</label>
                    <input type="file" id="avatar" accept="image/*">
                    <div id="avatar-preview"></div>
                </div>

                <div class="form-group">
                    <button id="worldBookBtn" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">ğŸ“š
                        ç¼–è¾‘ä¸–ç•Œä¹¦</button>
                </div>

                <div class="form-group">
                    <button id="openRegexEditorBtn" class="btn btn-secondary"
                        style="width: 100%; margin-bottom: 10px;">ğŸ”§ æ­£åˆ™è¡¨è¾¾å¼å·¥å…·</button>
                </div>

                <div class="form-group">
                    <button id="regexScriptsBtn" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">ğŸ“œ
                        æ­£åˆ™è„šæœ¬ç®¡ç†</button>
                </div>

                <div class="button-group">
                    <button id="saveLocalBtn" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">ğŸ’¾
                        ä¿å­˜åˆ°æµè§ˆå™¨</button>
                    <button id="loadLocalBtn" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;">ğŸ“‚
                        ä»æµè§ˆå™¨åŠ è½½</button>
                </div>

                <div class="button-group">
                    <button id="exportBtn" class="btn btn-primary">ğŸ“¥ å¯¼å‡º PNG</button>
                    <button id="exportJsonBtn" class="btn btn-primary">ğŸ“¥ å¯¼å‡º JSON</button>
                </div>
                <div class="button-group">
                    <button id="importBtn" class="btn btn-secondary">ğŸ“¤ å¯¼å…¥è§’è‰²å¡</button>
                    <button id="clearBtn" class="btn btn-danger">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
                <input type="file" id="importFile" accept=".png" style="display: none;">
            </div>

            <div class="preview-panel">
                <h2>é¢„è§ˆ</h2>
                <div class="character-card">
                    <div class="card-avatar" id="previewAvatar">
                        <span class="placeholder-text">æš‚æ— å¤´åƒ</span>
                    </div>
                    <div class="card-info">
                        <h3 id="previewName">è§’è‰²åç§°</h3>
                        <div class="info-section">
                            <strong>æè¿°ï¼š</strong>
                            <p id="previewDescription">æš‚æ— æè¿°</p>
                        </div>
                        <div class="info-section">
                            <strong>æ€§æ ¼ï¼š</strong>
                            <p id="previewPersonality">æš‚æ— æ€§æ ¼æè¿°</p>
                        </div>
                        <div class="info-section">
                            <strong>åœºæ™¯ï¼š</strong>
                            <p id="previewScenario">æš‚æ— åœºæ™¯è®¾å®š</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸–ç•Œä¹¦ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div id="worldBookModal" class="modal">
        <div class="modal-content worldbook-modal">
            <div class="modal-header worldbook-header">
                <div>
                    <p class="modal-eyebrow">WORLD BOOK WORKSPACE</p>
                    <h2>ğŸ“š ä¸–ç•Œä¹¦ç¼–è¾‘å™¨</h2>
                    <p class="modal-subtitle">é›†ä¸­ç®¡ç†è§¦å‘å…³é”®è¯ã€èƒŒæ™¯è®¾å®šä¸æç¤ºè¯ï¼Œè®©è§’è‰²ä¿¡æ¯ä¸ä¸–ç•Œè§‚ä¿æŒä¸€è‡´</p>
                </div>
                <span class="close">&times;</span>
            </div>
            <div class="worldbook-toolbar">
                <div class="toolbar-field">
                    <label for="lorebookName">ä¸–ç•Œä¹¦åç§°</label>
                    <input type="text" id="lorebookName" placeholder="ä¸ºè¿™ä¸ªä¸–ç•Œä¹¦å‘½å...">
                </div>
                <div class="toolbar-actions">
                    <div class="search-field">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" id="searchEntry" class="search-input" placeholder="æœç´¢æ¡ç›®ã€å…³é”®è¯æˆ–å†…å®¹">
                    </div>
                    <button id="addEntryBtn" class="btn btn-primary">â• æ–°å¢æ¡ç›®</button>
                </div>
            </div>
            <div class="worldbook-meta-grid">
                <div class="meta-card">
                    <span class="meta-label">æ€»æ¡ç›®</span>
                    <strong id="entryCount">0</strong>
                    <p class="meta-hint">æ‰€æœ‰ä¸–ç•Œä¹¦æ¡ç›®æ•°é‡</p>
                </div>
                <div class="meta-card">
                    <span class="meta-label">å·²å¯ç”¨</span>
                    <strong id="enabledCount">0</strong>
                    <p class="meta-hint">å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ¡ç›®</p>
                </div>
            </div>
            <div id="entriesList" class="worldbook-entries">
                <div class="worldbook-empty-state">
                    <div class="empty-icon">ğŸ—‚ï¸</div>
                    <p class="empty-title">è¿˜æ²¡æœ‰ä¸–ç•Œä¹¦æ¡ç›®</p>
                    <p class="hint">ç‚¹å‡»ã€Œæ–°å¢æ¡ç›®ã€å¼€å§‹è®°å½•ä¸–ç•Œè§‚ã€æç¤ºè¯ä¸èƒŒæ™¯ç»†èŠ‚</p>
                </div>
            </div>
            <div class="modal-footer worldbook-footer">
                <span class="footer-hint">ä½¿ç”¨ä¸Šä¸‹ç®­å¤´è°ƒæ•´é¡ºåºï¼Œæˆ–é€šè¿‡å¯ç”¨å¼€å…³å¿«é€Ÿæ§åˆ¶æ¡ç›®</span>
                <button id="closeModalBtn" class="btn btn-secondary">å…³é—­</button>
            </div>
        </div>
    </div>

<!-- æ­£åˆ™è„šæœ¬ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="regexScriptsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“œ æ­£åˆ™è¡¨è¾¾å¼è„šæœ¬</h2>
                <span class="close close-regex-scripts">&times;</span>
            </div>
            <div class="modal-body">
                <div class="worldbook-controls">
                    <button id="addRegexScriptBtn" class="btn btn-primary">â• æ·»åŠ è„šæœ¬</button>
                    <div class="worldbook-info">
                        <span>å…± <strong id="regexScriptCount">0</strong> ä¸ªè„šæœ¬</span>
                    </div>
                </div>

                <div class="info-callout">
                    <strong>ğŸ’¡ ä»€ä¹ˆæ˜¯æ­£åˆ™è„šæœ¬ï¼Ÿ</strong><br>
                    æ­£åˆ™è„šæœ¬å¯ä»¥åœ¨å‘é€ç»™ AI ä¹‹å‰è‡ªåŠ¨æŸ¥æ‰¾å’Œæ›¿æ¢æ–‡æœ¬å†…å®¹ã€‚<br>
                    ä¾‹å¦‚ï¼šéšè—çŠ¶æ€æ ã€æ›¿æ¢ç‰¹å®šæ ‡è®°ã€æ ¼å¼åŒ–æ–‡æœ¬ç­‰ã€‚
                </div>

                <div id="regexScriptsList" class="entries-list">
                    <div class="empty-state">
                        <p>æš‚æ— æ­£åˆ™è„šæœ¬</p>
                        <p class="hint">æ­£åˆ™è„šæœ¬ç”¨äºåœ¨å‘é€ç»™ AI ä¹‹å‰å¯¹æ–‡æœ¬è¿›è¡ŒæŸ¥æ‰¾å’Œæ›¿æ¢</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-regex-scripts">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- æ­£åˆ™è¡¨è¾¾å¼ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div id="regexEditorModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>ğŸ”§ æ­£åˆ™è¡¨è¾¾å¼ç¼–è¾‘å™¨</h2>
                <span class="close close-regex">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>
                        æ­£åˆ™è¡¨è¾¾å¼ (Regex)
                        <button class="btn-small" onclick="showRegexHelp()"
                            style="margin-left: 10px; padding: 4px 10px;">â“ å¸®åŠ©</button>
                    </label>
                    <input type="text" id="regexPattern" placeholder="ä¾‹å¦‚ï¼š\b(é­”æ³•|æ³•æœ¯)\b"
                        style="font-family: 'Courier New', monospace;">
                    <div class="help-text">è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æ¥åŒ¹é…æ–‡æœ¬</div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="regexCaseSensitive">
                        åŒºåˆ†å¤§å°å†™ (Case Sensitive)
                    </label>
                </div>

                <div class="form-group">
                    <label>æµ‹è¯•æ–‡æœ¬</label>
                    <textarea id="regexTestText" rows="4" placeholder="è¾“å…¥æµ‹è¯•æ–‡æœ¬ï¼Œçœ‹çœ‹æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…..."></textarea>
                </div>

                <div class="form-group">
                    <button class="btn btn-primary" onclick="testRegex()">ğŸ§ª æµ‹è¯•åŒ¹é…</button>
                </div>

                <div id="regexResult" class="regex-result-container" style="display: none;">
                    <div class="regex-result-wrapper">
                        <strong>æµ‹è¯•ç»“æœï¼š</strong>
                        <div id="regexResultText"></div>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <label>å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹</label>
                    <div style="display: grid; gap: 10px; margin-top: 10px;">
                        <button class="btn-small" onclick="insertRegexExample('\\b{{char}}\\b')"
                            style="text-align: left; padding: 10px;">
                            <strong>\b{{char}}\b</strong> - åŒ¹é…è§’è‰²åç§°ï¼ˆå•è¯è¾¹ç•Œï¼‰
                        </button>
                        <button class="btn-small" onclick="insertRegexExample('\\b(é­”æ³•|æ³•æœ¯|å’’è¯­)\\b')"
                            style="text-align: left; padding: 10px;">
                            <strong>\b(é­”æ³•|æ³•æœ¯|å’’è¯­)\b</strong> - åŒ¹é…å¤šä¸ªå…³é”®è¯ä¹‹ä¸€
                        </button>
                        <button class="btn-small" onclick="insertRegexExample('^ä½ å¥½')"
                            style="text-align: left; padding: 10px;">
                            <strong>^ä½ å¥½</strong> - åŒ¹é…ä»¥"ä½ å¥½"å¼€å¤´çš„æ–‡æœ¬
                        </button>
                        <button class="btn-small" onclick="insertRegexExample('å†è§$')"
                            style="text-align: left; padding: 10px;">
                            <strong>å†è§$</strong> - åŒ¹é…ä»¥"å†è§"ç»“å°¾çš„æ–‡æœ¬
                        </button>
                        <button class="btn-small" onclick="insertRegexExample('\\d+')"
                            style="text-align: left; padding: 10px;">
                            <strong>\d+</strong> - åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-regex">å…³é—­</button>
            </div>
        </div>
    </div>



    <script>
        // æŠ˜å /å±•å¼€åŠŸèƒ½ - å¿…é¡»åœ¨ HTML è§£æå‰å®šä¹‰
        window.toggleSection = function(headerElement, event) {
            console.log('toggleSection è¢«è°ƒç”¨', headerElement);
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…åµŒå¥—æŠ˜å åŒºåŸŸäº’ç›¸å¹²æ‰°
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            const section = headerElement.closest('.collapsible-section');
            console.log('æ‰¾åˆ°çš„ section:', section);
            
            if (section) {
                const wasCollapsed = section.classList.contains('collapsed');
                section.classList.toggle('collapsed');
                console.log('åˆ‡æ¢çŠ¶æ€:', wasCollapsed ? 'å±•å¼€' : 'æ”¶èµ·');
            } else {
                console.error('æœªæ‰¾åˆ° .collapsible-section çˆ¶å…ƒç´ ');
            }
        };
        
        // ç¢ºä¿ DOM å®Œå…¨åŠ è¼‰å¾Œå†åŸ·è¡Œ
        console.log('=== character-editor.html åˆå§‹åŒ– ===');
        console.log('DOM åŠ è¼‰ç‹€æ…‹:', document.readyState);
        console.log('ç•¶å‰ URL:', window.location.href);
        
        // æª¢æŸ¥é—œéµå…ƒç´ æ˜¯å¦å­˜åœ¨
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded äº‹ä»¶è§¸ç™¼');
            const criticalElements = [
                'name', 'exportBtn', 'exportJsonBtn', 'importBtn', 
                'worldBookBtn', 'previewName'
            ];
            
            criticalElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`å…ƒç´  #${id}:`, element ? 'âœ“ å­˜åœ¨' : 'âœ— ä¸å­˜åœ¨');
            });
            
            // é¡µé¢åŠ è½½æ—¶ï¼Œé»˜è®¤æŠ˜å æ‰€æœ‰å¯æŠ˜å åŒºåŸŸ
            console.log('=== åˆå§‹åŒ–æŠ˜å åŒºåŸŸ ===');
            const collapsibleSections = document.querySelectorAll('.collapsible-section');
            console.log('æ‰¾åˆ°', collapsibleSections.length, 'ä¸ªæŠ˜å åŒºåŸŸ');
            
            collapsibleSections.forEach((section, index) => {
                section.classList.add('collapsed');
                console.log(`åŒºåŸŸ ${index + 1} å·²è®¾ç½®ä¸ºæŠ˜å çŠ¶æ€`);
            });
        });
        
        // æ•ç²å…¨å±€éŒ¯èª¤
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€éŒ¯èª¤:', e.message, e.filename, e.lineno, e.colno);
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', e.reason);
        });
        
        // ç›´æ¥ä¿®å¾©ï¼šç‚ºæ­£å‰‡ç·¨è¼¯å™¨æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
        console.log('=== æ·»åŠ æ­£å‰‡ç·¨è¼¯å™¨æŒ‰éˆ•ç›£è½å™¨ ===');
        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('openRegexEditorBtn');
            const modal = document.getElementById('regexEditorModal');
            
            console.log('æŒ‰éˆ•:', btn);
            console.log('æ¨¡æ…‹æ¡†:', modal);
            
            if (btn && modal) {
                console.log('âœ“ æ·»åŠ é»æ“Šäº‹ä»¶');
                btn.addEventListener('click', function() {
                    console.log('âœ“ æŒ‰éˆ•è¢«é»æ“Šï¼Œæ‰“é–‹æ¨¡æ…‹æ¡†');
                    modal.style.display = 'block';
                });
                
                // æ·»åŠ é—œé–‰åŠŸèƒ½
                const closeBtns = modal.querySelectorAll('.close-regex');
                closeBtns.forEach(function(closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        modal.style.display = 'none';
                    });
                });
                
                // é»æ“Šå¤–éƒ¨é—œé–‰
                window.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            } else {
                console.error('âœ— æ‰¾ä¸åˆ°æŒ‰éˆ•æˆ–æ¨¡æ…‹æ¡†');
            }
            
            // æ­£å‰‡è…³æœ¬ç®¡ç†æŒ‰éˆ•
            console.log('=== æ·»åŠ æ­£å‰‡è…³æœ¬ç®¡ç†æŒ‰éˆ•ç›£è½å™¨ ===');
            const scriptsBtn = document.getElementById('regexScriptsBtn');
            const scriptsModal = document.getElementById('regexScriptsModal');
            
            console.log('è…³æœ¬æŒ‰éˆ•:', scriptsBtn);
            console.log('è…³æœ¬æ¨¡æ…‹æ¡†:', scriptsModal);
            
            if (scriptsBtn && scriptsModal) {
                console.log('âœ“ æ·»åŠ è…³æœ¬ç®¡ç†é»æ“Šäº‹ä»¶');
                scriptsBtn.addEventListener('click', function() {
                    console.log('âœ“ è…³æœ¬ç®¡ç†æŒ‰éˆ•è¢«é»æ“Šï¼Œæ‰“é–‹æ¨¡æ…‹æ¡†');
                    scriptsModal.style.display = 'block';
                    // å¦‚æœ renderRegexScripts å‡½æ•¸å­˜åœ¨ï¼Œèª¿ç”¨å®ƒ
                    if (typeof window.renderRegexScripts === 'function') {
                        window.renderRegexScripts();
                    }
                });
                
                // æ·»åŠ é—œé–‰åŠŸèƒ½
                const closeScriptsBtns = scriptsModal.querySelectorAll('.close-regex-scripts');
                closeScriptsBtns.forEach(function(closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        scriptsModal.style.display = 'none';
                    });
                });
                
                // é»æ“Šå¤–éƒ¨é—œé–‰
                window.addEventListener('click', function(e) {
                    if (e.target === scriptsModal) {
                        scriptsModal.style.display = 'none';
                    }
                });
            } else {
                console.error('âœ— æ‰¾ä¸åˆ°è…³æœ¬ç®¡ç†æŒ‰éˆ•æˆ–æ¨¡æ…‹æ¡†');
            }
        });
    </script>
    <script src="script.js"></script>
</body>

</html>